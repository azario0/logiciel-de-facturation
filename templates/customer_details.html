{% extends "base.html" %}

{% block content %}
<h1>{{ customer.name }}'s Billings</h1>
<a href="{{ url_for('add_billing', customer_id=customer.id) }}" class="button">Add Billing</a>
<a href="{{ url_for('generate_pdf', customer_id=customer.id) }}" class="button">Generate PDF</a>
<form action="{{ url_for('delete_customer', customer_id=customer.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this customer?');">
    <button type="submit" class="button delete-button">Delete Customer</button>
</form>

{% set grand_total = namespace(value=0) %}
{% for date, day_billings in grouped_billings %}
    <h2>Date: {{ date.strftime('%Y-%m-%d') }}</h2>
    <table>
        <thead>
            <tr>
                <th>Billing ID</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Price (DZD)</th>
                <th>Total (DZD)</th>
            </tr>
        </thead>
        <tbody>
            {% set day_total = namespace(value=0) %}
            {% for billing in day_billings %}
                {% for item in billing.items %}
                <tr>
                    <td>{{ billing.id }}</td>
                    <td>{{ item.product.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ "%.2f"|format(item.product.price) }}</td>
                    {% set item_total = item.quantity * item.product.price %}
                    <td>{{ "%.2f"|format(item_total) }}</td>
                    {% set day_total.value = day_total.value + item_total %}
                </tr>
                {% endfor %}
            {% endfor %}
        </tbody>
    </table>
    <p>Day Total: {{ "%.2f"|format(day_total.value) }} DZD</p>
    {% set grand_total.value = grand_total.value + day_total.value %}
{% endfor %}
<h2>Grand Total: {{ "%.2f"|format(grand_total.value) }} DZD</h2>
{% endblock %}
